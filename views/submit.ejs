<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, interactive-widget=resizes-content">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="robots" content="noindex, nofollow">
  <title>Submit a Tip ‚Äî <%= settings.boardName %></title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script>
    (function(){try{var t=localStorage.getItem('vvc-theme'),s=localStorage.getItem('vvc-scheme');document.documentElement.setAttribute('data-scheme',s||'forest');document.documentElement.setAttribute('data-theme',t||(window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light'));}catch(e){document.documentElement.setAttribute('data-scheme','forest');document.documentElement.setAttribute('data-theme','light');}})();
  </script>
  <% if (sitekey) { %>
    <script src="https://hcaptcha.com/1/api.js" async defer></script>
  <% } %>
</head>
<body>
  <div class="vvc-container vvc-container--wide">
    <!-- Back -->
    <a href="/" class="back-link">
      <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <%= settings.boardName %>
    </a>

    <% if (success) { %>
      <div class="success-card">
        <div class="success-icon">
          <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <h2 class="success-title">Tip received ‚Äî thank you!</h2>
        <p class="success-text">Moderators review all submissions.<br>Not all tips are posted. You won't be notified of the outcome.</p>
        <div class="success-actions">
          <a href="/" class="btn-outline-vvc">Back to board</a>
          <a href="/submit" class="btn-outline-vvc">Submit another</a>
        </div>
      </div>
    <% } else { %>

      <!-- Title -->
      <div class="page-title-area">
        <h1 class="page-title">Share with the neighborhood</h1>
        <p class="page-subtitle">Mods review all submissions. Not all tips are posted. You won't be notified.</p>
      </div>

      <!-- Form -->
      <div class="form-card">
        <% if (error) { %>
          <div class="alert-banner danger" style="margin-bottom: 1rem;"><%= error %></div>
        <% } %>

        <form method="POST" action="/submit" id="submitForm">
          <!-- Honeypot -->
          <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

          <div class="field-group">
            <label class="vvc-label" for="title">Title <span class="required-star">*</span></label>
            <input type="text" class="vvc-input" id="title" name="title"
                   maxlength="100" placeholder="e.g. Suspicious van on Elm St"
                   value="<%= values.title || '' %>">
          </div>

          <div class="field-group">
            <label class="vvc-label">Description <span class="required-star">*</span></label>
            <div class="editor-wrapper">
              <div class="editor-toolbar" id="toolbar">
                <button type="button" data-action="bold" title="Bold"><b>B</b></button>
                <button type="button" data-action="italic" title="Italic"><i>I</i></button>
                <button type="button" data-action="strike" title="Strikethrough"><s>S</s></button>
                <div class="sep"></div>
                <button type="button" data-action="link" title="Add Link">üîó</button>
                <div class="sep"></div>
                <button type="button" data-action="image" title="Upload Image">üì∑</button>
                <button type="button" data-action="video" title="Upload Video">üé•</button>
              </div>
              <div id="editor"></div>
            </div>
            <input type="hidden" name="desc" id="descHidden" value="">
            <p class="vvc-hint">You can paste or drag images and videos directly into the editor.</p>
          </div>

          <div class="field-group">
            <label class="vvc-label" for="location">Location <span class="optional">(optional)</span></label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <button type="button" class="map-pin-btn" id="findOnMapBtn" title="Find this location on the map" aria-label="Find location on map">
                <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
              </button>
              <input type="text" class="vvc-input" id="location" name="location"
                     maxlength="100" placeholder="e.g. Near Elm St & Oak Ave"
                     value="<%= values.location || '' %>" style="flex: 1;">
            </div>
            <p class="vvc-hint">Be vague ‚Äî street name or intersection is enough.</p>
          </div>

          <div class="field-group">
            <label style="font-size: 0.8rem; color: var(--text-secondary); display: block; margin-bottom: 6px;">Map Pin (optional)</label>
            <div id="mapContainer" class="submit-map-container"></div>
            <div class="map-coord-display">
              <span id="mapDisplay">Click map to drop a pin</span>
              <button type="button" class="btn-link-vvc" id="removePin" style="font-size: 0.75rem; margin-left: 8px;">
                Remove pin
              </button>
            </div>
            <input type="hidden" name="latitude" id="latitude">
            <input type="hidden" name="longitude" id="longitude">
            <input type="hidden" name="locationName" id="locationName">
          </div>

          <div class="field-group">
            <label class="vvc-label">Category <span class="required-star">*</span></label>
            <div class="category-grid">
              <label class="category-option <%= values.section === 'ALERT' ? 'selected' : (!values.section ? '' : '') %>" onclick="selectCat(this)">
                <input type="radio" name="section" value="ALERT" <%= values.section === 'ALERT' ? 'checked' : '' %>>
                <span class="category-icon">üõ°Ô∏è</span>
                <span class="category-label">Alert / Safety</span>
              </label>
              <label class="category-option <%= values.section === 'HAPPENINGS' ? 'selected' : '' %>" onclick="selectCat(this)">
                <input type="radio" name="section" value="HAPPENINGS" <%= values.section === 'HAPPENINGS' ? 'checked' : '' %>>
                <span class="category-icon">üìÖ</span>
                <span class="category-label">Happening</span>
              </label>
              <label class="category-option <%= values.section === 'LOST_FOUND' ? 'selected' : '' %>" onclick="selectCat(this)">
                <input type="radio" name="section" value="LOST_FOUND" <%= values.section === 'LOST_FOUND' ? 'checked' : '' %>>
                <span class="category-icon">üîç</span>
                <span class="category-label">Lost & Found</span>
              </label>
              <label class="category-option <%= values.section === 'NEIGHBORS' ? 'selected' : '' %>" onclick="selectCat(this)">
                <input type="radio" name="section" value="NEIGHBORS" <%= values.section === 'NEIGHBORS' ? 'checked' : '' %>>
                <span class="category-icon">ü§ù</span>
                <span class="category-label">Neighbors</span>
              </label>
            </div>
          </div>

          <% if (sitekey) { %>
            <div class="field-group">
              <div class="h-captcha" data-sitekey="<%= sitekey %>"></div>
            </div>
          <% } %>

          <button type="submit" class="btn-primary-vvc full-width">Submit for Review</button>
          <div class="validation-banner" id="validationBanner" style="display:none;"></div>
        </form>
      </div>

      <div class="privacy-note">
        <span class="privacy-note-inner">
          <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          Completely anonymous ‚Äî no personal info collected
        </span>
      </div>
    <% } %>
  </div>

  <script src="/js/theme.js"></script>
  <% if (!success) { %>
  <script src="/js/category-select.js"></script>
  <script type="module" src="/js/submit-init.js"></script>
  <script type="module" src="/js/submit-map.js"></script>
  <% } %>
  <script>if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js');}</script>
</body>
</html>
