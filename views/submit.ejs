<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Submit a Tip ‚Äî <%= settings.boardName %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <% if (sitekey) { %>
    <script src="https://hcaptcha.com/1/api.js" async defer></script>
  <% } %>
  <style>
    :root { --vvc-green: #2d6a4f; --vvc-green-light: #40916c; --vvc-bg: #f0f4f0; }
    body { background: var(--vvc-bg); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .brand { font-weight: 800; color: var(--vvc-green); letter-spacing: -0.5px; text-decoration: none; }
    .brand:hover { color: var(--vvc-green-light); }
    .form-card { border: none; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .btn-submit { background: var(--vvc-green); border-color: var(--vvc-green); color: #fff; border-radius: 8px; }
    .btn-submit:hover { background: var(--vvc-green-light); border-color: var(--vvc-green-light); color: #fff; }

    /* Tiptap editor styling */
    .editor-wrapper { border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
    .editor-toolbar {
      display: flex; flex-wrap: wrap; gap: 2px; padding: 6px 8px;
      background: #f8f9fa; border-bottom: 1px solid #dee2e6;
    }
    .editor-toolbar button {
      background: none; border: 1px solid transparent; border-radius: 4px;
      padding: 4px 8px; font-size: 0.8rem; cursor: pointer; color: #555;
    }
    .editor-toolbar button:hover { background: #e9ecef; }
    .editor-toolbar button.active { background: #dee2e6; color: #000; border-color: #ced4da; }
    .editor-toolbar .sep { width: 1px; background: #dee2e6; margin: 2px 4px; }

    .tiptap-content { min-height: 120px; padding: 10px; outline: none; font-size: 0.9rem; }
    .tiptap-content p { margin-bottom: 0.5rem; }
    .tiptap-content img { max-width: 100%; border-radius: 8px; margin: 4px; vertical-align: top; display: inline-block; }
    .tiptap-content video { max-width: 100%; border-radius: 8px; margin: 8px 0; }
    .tiptap-content a { color: var(--vvc-green); }
    .tiptap-content blockquote { border-left: 3px solid #dee2e6; padding-left: 12px; color: #666; }
    .tiptap-content h2 { font-size: 1.1rem; font-weight: 700; }
    .tiptap-content h3 { font-size: 1rem; font-weight: 600; }
    .tiptap-content p.is-editor-empty:first-child::before {
      content: attr(data-placeholder); float: left; color: #adb5bd; pointer-events: none; height: 0;
    }
    /* Resize handles */
    .tiptap-content .image-resizer { display: inline-block; position: relative; }
    .tiptap-content .image-resizer img { display: block; max-width: 100%; }
    .tiptap-content .image-resizer .resize-trigger { position: absolute; right: -4px; bottom: -4px; width: 12px; height: 12px; background: var(--vvc-green); border: 2px solid #fff; border-radius: 2px; cursor: nwse-resize; }
  </style>
</head>
<body>
  <div class="container py-4" style="max-width: 580px;">
    <div class="text-center mb-4">
      <a href="/" class="brand fs-4">&larr; <%= settings.boardName %></a>
    </div>

    <% if (success) { %>
      <div class="alert alert-success text-center" role="alert">
        <strong>Thank you.</strong> Your tip has been received.
      </div>
      <p class="text-center text-muted" style="font-size: 0.85rem;">
        Moderators review all submissions. Not all tips are posted. You won't be notified of the outcome.
      </p>
      <div class="text-center">
        <a href="/" class="btn btn-outline-secondary btn-sm">Back to board</a>
        <a href="/submit" class="btn btn-outline-secondary btn-sm ms-2">Submit another</a>
      </div>
    <% } else { %>

      <div class="card form-card">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-1">Submit a Tip</h5>
          <p class="text-muted" style="font-size: 0.82rem;">
            Moderators review all submissions. Not all tips are posted. You won't be notified of the outcome.
          </p>

          <% if (error) { %>
            <div class="alert alert-danger py-2" style="font-size: 0.85rem;" role="alert"><%= error %></div>
          <% } %>

          <form method="POST" action="/submit" id="submitForm">
            <!-- Honeypot -->
            <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">

            <div class="mb-3">
              <label for="title" class="form-label fw-semibold" style="font-size: 0.85rem;">Title</label>
              <input type="text" class="form-control" id="title" name="title"
                     maxlength="100" required placeholder="e.g. Suspicious van on Elm St"
                     value="<%= values.title || '' %>">
            </div>

            <div class="mb-3">
              <label class="form-label fw-semibold" style="font-size: 0.85rem;">Description</label>
              <div class="editor-wrapper">
                <div class="editor-toolbar" id="toolbar">
                  <button type="button" data-action="bold" title="Bold"><b>B</b></button>
                  <button type="button" data-action="italic" title="Italic"><i>I</i></button>
                  <div class="sep"></div>
                  <button type="button" data-action="link" title="Add Link">üîó</button>
                  <div class="sep"></div>
                  <button type="button" data-action="image" title="Upload Image">üì∑</button>
                  <button type="button" data-action="video" title="Upload Video">üé•</button>
                </div>
                <div id="editor"></div>
              </div>
              <input type="hidden" name="desc" id="descHidden" value="">
              <div class="form-text" style="font-size: 0.72rem;">You can paste or drag images and videos directly into the editor.</div>
            </div>

            <div class="mb-3">
              <label for="location" class="form-label fw-semibold" style="font-size: 0.85rem;">Approximate Location <small class="text-muted">(optional)</small></label>
              <input type="text" class="form-control" id="location" name="location"
                     maxlength="100" placeholder="e.g. Near Elm St & Oak Ave"
                     value="<%= values.location || '' %>">
              <div class="form-text" style="font-size: 0.75rem;">Be vague ‚Äî street name or intersection is enough.</div>
            </div>

            <div class="mb-3">
              <label for="section" class="form-label fw-semibold" style="font-size: 0.85rem;">Category</label>
              <select class="form-select" id="section" name="section" required>
                <option value="" disabled <%= !values.section ? 'selected' : '' %>>Select one...</option>
                <option value="ALERT" <%= values.section === 'ALERT' ? 'selected' : '' %>>üõ°Ô∏è Alert / Safety</option>
                <option value="HAPPENINGS" <%= values.section === 'HAPPENINGS' ? 'selected' : '' %>>üìÖ Happening / Event</option>
                <option value="LOST_FOUND" <%= values.section === 'LOST_FOUND' ? 'selected' : '' %>>üîç Lost & Found</option>
                <option value="NEIGHBORS" <%= values.section === 'NEIGHBORS' ? 'selected' : '' %>>ü§ù Neighbors</option>
              </select>
            </div>

            <% if (sitekey) { %>
              <div class="mb-3">
                <div class="h-captcha" data-sitekey="<%= sitekey %>"></div>
              </div>
            <% } %>

            <button type="submit" class="btn btn-submit w-100 py-2 fw-semibold">Submit Tip for Review</button>
          </form>
        </div>
      </div>

      <div class="text-center mt-3">
        <small class="text-muted">Completely anonymous. No personal info is collected.</small>
      </div>

    <% } %>
  </div>

  <% if (!success) { %>
  <script type="module" src="/js/submit-init.js"></script>
  <% } %>
</body>
</html>
