<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title><%= settings.boardName %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --vvc-green: #2d6a4f; --vvc-green-light: #40916c; --vvc-bg: #f0f4f0;
      --alert-color: #dc3545; --happenings-color: #6f42c1;
      --lostfound-color: #0d6efd; --neighbors-color: #2d6a4f;
      --boardnotes-color: #6c757d;
    }
    body { background: var(--vvc-bg); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .brand { font-weight: 800; color: var(--vvc-green); letter-spacing: -0.5px; }
    .brand-sub { color: #6c757d; font-size: 0.85rem; }

    .section-block { margin-bottom: 2rem; }
    .section-header {
      font-weight: 700; font-size: 1rem; padding: 8px 12px;
      border-radius: 8px; margin-bottom: 0.75rem;
      display: flex; align-items: center; gap: 8px;
    }
    .section-header .icon { font-size: 1.1rem; }
    .section-header .count { font-size: 0.7rem; background: rgba(0,0,0,0.1); border-radius: 10px; padding: 1px 8px; }

    .section-ALERT .section-header { background: rgba(220,53,69,0.1); color: var(--alert-color); }
    .section-HAPPENINGS .section-header { background: rgba(111,66,193,0.1); color: var(--happenings-color); }
    .section-LOST_FOUND .section-header { background: rgba(13,110,253,0.1); color: var(--lostfound-color); }
    .section-NEIGHBORS .section-header { background: rgba(45,106,79,0.1); color: var(--neighbors-color); }
    .section-BOARD_NOTES .section-header { background: rgba(108,117,125,0.1); color: var(--boardnotes-color); }

    .post-card {
      border: none; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      transition: box-shadow 0.2s; margin-bottom: 0.5rem; border-left: 4px solid transparent;
    }
    .post-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.12); }

    .section-ALERT .post-card { border-left-color: var(--alert-color); }
    .section-HAPPENINGS .post-card { border-left-color: var(--happenings-color); }
    .section-LOST_FOUND .post-card { border-left-color: var(--lostfound-color); }
    .section-NEIGHBORS .post-card { border-left-color: var(--neighbors-color); }
    .section-BOARD_NOTES .post-card { border-left-color: var(--boardnotes-color); }

    .post-card.urgent { border-left-width: 6px; }
    .pin-icon { color: #e67e22; font-size: 0.75rem; }
    .urgent-badge { background: #dc3545; color: #fff; font-size: 0.65rem; border-radius: 4px; padding: 1px 6px; font-weight: 600; }

    .submit-fab {
      position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px;
      border-radius: 50%; background: var(--vvc-green); color: #fff; border: none;
      font-size: 1.6rem; box-shadow: 0 4px 12px rgba(45,106,79,0.4);
      display: flex; align-items: center; justify-content: center;
      text-decoration: none; z-index: 100;
    }
    .submit-fab:hover { background: var(--vvc-green-light); color: #fff; }

    .search-bar { border-radius: 20px; border: 1px solid #ddd; }
    .search-bar:focus { border-color: var(--vvc-green); box-shadow: 0 0 0 2px rgba(45,106,79,0.15); }

    .empty-state { padding: 4rem 1rem; text-align: center; color: #999; }
    .about-section { background: #fff; border-radius: 10px; padding: 1.25rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
    .about-section h6 { font-weight: 700; color: var(--vvc-green); }
  </style>
</head>
<body>
  <div class="container py-4" style="max-width: 680px;">
    <!-- Header -->
    <div class="text-center mb-3">
      <h1 class="brand mb-0"><%= settings.boardName %></h1>
      <p class="brand-sub mb-0"><%= settings.boardTagline %></p>
    </div>

    <!-- Search (client-side) -->
    <div class="mb-3">
      <input
        type="text"
        id="boardSearch"
        class="form-control search-bar"
        placeholder="Search the board..."
        aria-label="Search posts"
      >
    </div>

    <%
      const sections = [
        { key: 'alerts', name: 'Alerts', icon: 'üõ°Ô∏è', section: 'ALERT' },
        { key: 'happenings', name: 'Happenings', icon: 'üìÖ', section: 'HAPPENINGS' },
        { key: 'lostFound', name: 'Lost & Found', icon: 'üîç', section: 'LOST_FOUND' },
        { key: 'neighbors', name: 'Neighbors', icon: 'ü§ù', section: 'NEIGHBORS' },
        { key: 'boardNotes', name: 'Board Notes', icon: 'üì¢', section: 'BOARD_NOTES' },
      ];

      const allEmpty = sections.every(s => board[s.key].length === 0);
    %>

    <% if (allEmpty) { %>
      <div class="empty-state">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìã</div>
        <p>The board is empty right now.</p>
        <p class="text-muted" style="font-size: 0.85rem;">Be the first to share something with the neighborhood!</p>
      </div>
    <% } else { %>
      <% sections.forEach(sec => { %>
        <% if (board[sec.key].length > 0) { %>
          <div class="section-block section-<%= sec.section %>">
            <div class="section-header">
              <span class="icon"><%= sec.icon %></span>
              <span><%= sec.name %></span>
              <span class="count"><%= board[sec.key].length %></span>
            </div>

            <% board[sec.key].forEach(post => { %>
              <div class="card post-card searchable <%= post.urgent ? 'urgent' : '' %>" data-text="<%= (post.title + ' ' + post.desc + ' ' + (post.location || '')).toLowerCase() %>">
                <div class="card-body py-2 px-3">
                  <div class="d-flex justify-content-between align-items-start mb-1">
                    <div class="d-flex align-items-center gap-2">
                      <% if (post.pinned) { %><span class="pin-icon" title="Pinned">üìå</span><% } %>
                      <h6 class="card-title mb-0 fw-bold" style="font-size: 0.95rem;"><%= post.title %></h6>
                    </div>
                    <% if (post.urgent) { %><span class="urgent-badge">URGENT</span><% } %>
                  </div>
                  <p class="card-text mt-1 mb-2" style="font-size: 0.88rem; color: #444;"><%= post.desc %></p>
                  <small class="text-muted">
                    <% if (post.location) { %>üìç <%= post.location %> &middot; <% } %>
                    <%= timeAgo(post.approvedAt || post.createdAt) %>
                    <% if (post.editedAt) { %>&middot; <em>edited</em><% } %>
                  </small>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      <% }) %>
    <% } %>

    <!-- About Section -->
    <% if (settings.aboutText) { %>
      <div class="about-section">
        <h6>About</h6>
        <p class="mb-0" style="font-size: 0.88rem; color: #555; white-space: pre-line;"><%= settings.aboutText %></p>
      </div>
    <% } %>

    <div class="text-center mt-3 mb-5">
      <small class="text-muted">No accounts, no tracking &middot; All posts reviewed by mods</small>
    </div>
  </div>

  <!-- Floating submit button -->
  <a href="/submit" class="submit-fab" title="Submit a tip" aria-label="Submit a tip">+</a>

  <script>
    // Client-side search
    const searchInput = document.getElementById('boardSearch');
    if (searchInput) {
      searchInput.addEventListener('input', function() {
        const q = this.value.toLowerCase().trim();
        document.querySelectorAll('.searchable').forEach(card => {
          const text = card.getAttribute('data-text') || '';
          card.style.display = (!q || text.includes(q)) ? '' : 'none';
        });
        // Hide empty section headers
        document.querySelectorAll('.section-block').forEach(block => {
          const visible = block.querySelectorAll('.searchable:not([style*="display: none"])');
          block.style.display = visible.length > 0 ? '' : 'none';
        });
      });
    }
  </script>
</body>
</html>
