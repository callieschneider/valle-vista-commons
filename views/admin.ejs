<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin ‚Äî Valle Vista Commons</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script>
    (function(){try{var t=localStorage.getItem('vvc-theme'),s=localStorage.getItem('vvc-scheme');document.documentElement.setAttribute('data-scheme',s||'forest');document.documentElement.setAttribute('data-theme',t||(window.matchMedia&&window.matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light'));}catch(e){document.documentElement.setAttribute('data-scheme','forest');document.documentElement.setAttribute('data-theme','light');}})();
  </script>
</head>
<body>
  <div class="vvc-container vvc-container--wide">
    <!-- Header -->
    <header class="admin-header">
      <div>
        <a href="/" class="admin-brand">
          <div class="admin-brand-mark">VV</div>
          <span class="admin-brand-text">Valle Vista Commons</span>
        </a>
        <span class="admin-breadcrumb">/ Admin</span>
      </div>
      <div class="admin-nav">
        <a href="/" class="nav-btn">View Board</a>
        <div class="theme-menu">
          <button class="theme-trigger" aria-label="Appearance" title="Appearance">
            <svg viewBox="0 0 24 24"><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/></svg>
          </button>
          <div class="theme-popover">
            <div class="popover-label">Mode</div>
            <div class="mode-toggle">
              <button class="mode-btn active" data-mode="light" title="Light">‚òÄÔ∏è</button>
              <button class="mode-btn" data-mode="dark" title="Dark">üåô</button>
            </div>
            <div class="popover-divider"></div>
            <div class="popover-label">Color</div>
            <div class="scheme-picker">
              <button class="scheme-dot active" data-scheme="forest" title="Forest"></button>
              <button class="scheme-dot" data-scheme="terracotta" title="Terracotta"></button>
              <button class="scheme-dot" data-scheme="slate" title="Slate"></button>
              <button class="scheme-dot" data-scheme="sage" title="Sage"></button>
              <button class="scheme-dot" data-scheme="indigo" title="Indigo"></button>
            </div>
            <div class="scheme-active-label">Forest</div>
          </div>
        </div>
      </div>
    </header>

    <!-- Error/Success Messages -->
    <% if (error) { %>
      <div class="alert-banner danger">
        <span>‚úó</span>
        <% if (error === 'not_found') { %>Post not found.
        <% } else if (error === 'no_rewrite') { %>No AI rewrite available for this post.
        <% } else if (error === 'rewrite_failed') { %>AI rewrite failed. Check API key and try again.
        <% } else if (error === 'no_undo') { %>No undo history for this post.
        <% } else if (error === 'notes_empty') { %>Title and description are required for Board Notes.
        <% } else { %><%= error %><% } %>
      </div>
    <% } %>
    <% if (msg) { %>
      <div class="alert-banner success">
        <span>‚úì</span>
        <% if (msg === 'approved') { %>Post approved!
        <% } else { %>Done.<% } %>
      </div>
    <% } %>

    <% if (!hasApiKey) { %>
      <div class="alert-banner warning">
        <span>‚ö†</span> <strong>AI features disabled</strong> ‚Äî No OpenRouter API key configured.
      </div>
    <% } %>

    <!-- ‚ïê‚ïê‚ïê PENDING REVIEW ‚ïê‚ïê‚ïê -->
    <div class="admin-section">
      <div class="admin-section-header">
        <span class="admin-section-title">Pending Review</span>
        <% if (pending.length > 0) { %><span class="admin-section-count"><%= pending.length %></span><% } %>
      </div>

      <% if (pending.length === 0) { %>
        <div style="text-align: center; padding: 2rem 1rem; color: var(--text-muted); font-size: 0.85rem;">No tips waiting for review.</div>
      <% } else { %>
        <% pending.forEach((post, idx) => { %>
          <div class="post-row">
            <div class="post-row-header">
              <span class="post-row-title"><%= post.title %></span>
              <span class="badge badge-section-<%= post.section %>"><%= post.section.replace('_', ' ') %></span>
              <% if (post.submitter) { %>
                <span class="badge-submitter" title="Anonymous submitter #<%= post.submitter.id %>">User #<%= post.submitter.id %><% if (submitterCounts[post.submitterId] > 1) { %> <span class="submitter-count">(<%= submitterCounts[post.submitterId] %> posts)</span><% } %></span>
              <% } %>
            </div>
            <div class="post-row-desc rich-content"><%- post.desc %></div>
            <div class="post-row-meta">
              <% if (post.location) { %><span>üìç <%= post.location %></span><span class="sep"></span><% } %>
              <span>Submitted <%= new Date(post.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' }) %></span>
            </div>

            <!-- AI Analysis Panel -->
            <% if (post.aiAnalysis) { %>
              <div class="ai-panel">
                <div class="ai-panel-grid">
                  <div class="ai-chip"><span class="ai-chip-label">Section: </span><span class="ai-chip-value"><%= post.aiAnalysis.suggestedSection %></span></div>
                  <div class="ai-chip"><span class="ai-chip-label">Urgency: </span><span class="ai-chip-value urgency-<%= post.aiAnalysis.urgency %>"><%= post.aiAnalysis.urgency %></span></div>
                  <div class="ai-chip"><span class="ai-chip-label">Rec: </span><span class="ai-chip-value rec-<%= post.aiAnalysis.recommendation %>"><%= post.aiAnalysis.recommendation %></span></div>
                  <div class="ai-chip"><span class="ai-chip-label">Sentiment: </span><span class="ai-chip-value" style="color: var(--text-secondary);"><%= post.aiAnalysis.sentiment %></span></div>
                </div>
                <% if (post.aiAnalysis.piiDetected && post.aiAnalysis.piiDetected.length > 0) { %>
                  <div class="ai-pii-warning">‚ö† PII detected: <%= post.aiAnalysis.piiDetected.join(', ') %></div>
                <% } %>
                <div class="ai-reasoning"><%= post.aiAnalysis.reasoning %></div>

                <% if (post.aiAnalysis.rewrite) { %>
                  <div style="margin-top: 6px;">
                    <span class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#rewrite-<%= idx %>">View AI Rewrite ‚ñæ</span>
                    <div class="collapse mt-1" id="rewrite-<%= idx %>">
                      <div class="inline-panel" style="margin-top: 4px; font-size: 0.78rem;">
                        <strong><%= post.aiAnalysis.rewrite.title %></strong><br>
                        <span style="color: var(--text-secondary);"><%= post.aiAnalysis.rewrite.desc %></span>
                      </div>
                    </div>
                  </div>
                <% } %>
              </div>
            <% } else { %>
              <div class="ai-panel" style="color: var(--text-muted);">
                <% if (hasApiKey) { %>
                  Analysis pending...
                  <form method="POST" action="/admin/reanalyze/<%= post.id %>" style="display: inline;">
                    <button type="submit" class="action-link" style="margin-left: 4px;">Retry</button>
                  </form>
                <% } else { %>
                  AI analysis not available (no API key)
                <% } %>
              </div>
            <% } %>

            <!-- Action Buttons -->
            <div class="actions-row">
              <!-- Primary: Approve + Reject -->
              <div class="action-group">
                <form method="POST" action="/admin/approve/<%= post.id %>" style="display: inline-flex; align-items: center; gap: 4px;">
                  <select name="section" class="section-select">
                    <% ['ALERT', 'HAPPENINGS', 'LOST_FOUND', 'NEIGHBORS'].forEach(s => { %>
                      <option value="<%= s %>" <%= (post.aiAnalysis?.suggestedSection === s || (!post.aiAnalysis && post.section === s)) ? 'selected' : '' %>><%= s.replace('_', ' ') %></option>
                    <% }) %>
                  </select>
                  <button type="submit" class="action-btn approve">Approve</button>
                </form>
                <form method="POST" action="/admin/reject/<%= post.id %>" style="display: inline;" onsubmit="return confirm('Reject this tip? It will move to archive.')">
                  <button type="submit" class="action-btn reject">Reject</button>
                </form>
              </div>

              <span class="actions-sep"></span>

              <!-- Secondary: Edit + AI -->
              <div class="action-group">
                <button type="button" class="action-btn outline" data-bs-toggle="collapse" data-bs-target="#edit-<%= idx %>">Edit</button>
                <% if (post.aiAnalysis?.rewrite) { %>
                  <form method="POST" action="/admin/rewrite/<%= post.id %>" style="display:inline;">
                    <input type="hidden" name="action" value="apply">
                    <button type="submit" class="action-btn outline ai">Apply Rewrite</button>
                  </form>
                <% } %>
                <% if (hasApiKey) { %>
                  <form method="POST" action="/admin/rewrite/<%= post.id %>" style="display:inline;">
                    <input type="hidden" name="action" value="quick">
                    <button type="submit" class="action-btn outline ai">Rewrite</button>
                  </form>
                  <button type="button" class="action-btn outline ai" data-bs-toggle="collapse" data-bs-target="#customRewrite-<%= idx %>">Custom Rewrite</button>
                <% } %>
                <% if (post.descHistory && post.descHistory.length > 0) { %>
                  <form method="POST" action="/admin/undo/<%= post.id %>" style="display:inline;">
                    <button type="submit" class="action-btn outline undo">Undo (<%= post.descHistory.length %>)</button>
                  </form>
                <% } %>
              </div>
            </div>

            <!-- Edit Form (collapsed) -->
            <div class="collapse mt-2" id="edit-<%= idx %>">
              <form method="POST" action="/admin/edit/<%= post.id %>" class="inline-panel">
                <div style="margin-bottom: 8px;">
                  <input type="text" name="title" class="vvc-input" value="<%= post.title %>" maxlength="100" style="font-size: 0.85rem; padding: 8px 12px;">
                </div>
                <div style="margin-bottom: 8px;">
                  <div class="editor-wrapper">
                    <div class="editor-toolbar" id="editToolbar-p<%= idx %>">
                      <button type="button" data-action="bold"><b>B</b></button>
                      <button type="button" data-action="italic"><i>I</i></button>
                      <div class="sep"></div>
                      <button type="button" data-action="heading2">H2</button>
                      <button type="button" data-action="heading3">H3</button>
                      <div class="sep"></div>
                      <button type="button" data-action="bulletList">‚Ä¢ List</button>
                      <button type="button" data-action="link">Link</button>
                      <div class="sep"></div>
                      <button type="button" data-action="image">Image</button>
                      <button type="button" data-action="video">Video</button>
                    </div>
                    <div class="admin-editor tiptap-content admin-editor" id="editEditor-p<%= idx %>" data-content="<%= encodeURIComponent(post.desc) %>"></div>
                  </div>
                  <input type="hidden" name="desc" id="editHidden-p<%= idx %>">
                </div>
                <div style="margin-bottom: 8px;">
                  <input type="text" name="location" class="vvc-input" value="<%= post.location || '' %>" maxlength="100" placeholder="Location (optional)" style="font-size: 0.85rem; padding: 8px 12px;">
                </div>
                <div style="margin-bottom: 8px;">
                  <label style="font-size: 0.8rem; color: var(--text-secondary); display: block; margin-bottom: 6px;">Map Pin (optional)</label>
                  <div id="adminMap-p<%= idx %>" class="admin-map-container"></div>
                  <div class="map-coord-display">
                    <span id="coordDisplay-p<%= idx %>">
                      <% if (post.latitude && post.longitude) { %>
                        üìç <%= post.latitude.toFixed(5) %>, <%= post.longitude.toFixed(5) %>
                      <% } else { %>
                        Click map to drop a pin
                      <% } %>
                    </span>
                    <button type="button" class="btn-link-vvc" id="removeMapPin-p<%= idx %>" style="font-size: 0.75rem; margin-left: 8px;">
                      Remove pin
                    </button>
                  </div>
                  <input type="hidden" name="latitude" id="adminLat-p<%= idx %>" value="<%= post.latitude || '' %>">
                  <input type="hidden" name="longitude" id="adminLng-p<%= idx %>" value="<%= post.longitude || '' %>">
                  <input type="hidden" name="locationName" id="adminName-p<%= idx %>" value="<%= post.locationName || '' %>">
                </div>
                <div style="margin-bottom: 8px;">
                  <select name="section" class="vvc-select" style="font-size: 0.85rem; padding: 8px 12px;">
                    <% ['ALERT', 'HAPPENINGS', 'LOST_FOUND', 'NEIGHBORS'].forEach(s => { %>
                      <option value="<%= s %>" <%= post.section === s ? 'selected' : '' %>><%= s.replace('_', ' ') %></option>
                    <% }) %>
                  </select>
                </div>
                <div class="panel-actions">
                  <button type="submit" class="panel-btn-primary">Save Edit</button>
                  <button type="button" class="panel-btn-ghost" data-bs-toggle="collapse" data-bs-target="#edit-<%= idx %>">Discard</button>
                </div>
              </form>
            </div>

            <!-- Custom Rewrite Form (collapsed) -->
            <% if (hasApiKey) { %>
              <div class="collapse mt-2" id="customRewrite-<%= idx %>">
                <form method="POST" action="/admin/rewrite/<%= post.id %>" class="inline-panel">
                  <input type="hidden" name="action" value="custom">
                  <div style="margin-bottom: 8px;">
                    <input type="text" name="instructions" class="vvc-input" placeholder="e.g. Make shorter, remove location details" required style="font-size: 0.85rem; padding: 8px 12px;">
                  </div>
                  <div style="display: flex; align-items: center; gap: 8px;">
                    <button type="submit" class="panel-btn-primary">Rewrite with AI</button>
                    <span style="font-size: 0.72rem; color: var(--text-muted);">(takes a few seconds)</span>
                  </div>
                </form>
              </div>
            <% } %>
          </div>
        <% }) %>
      <% } %>
    </div>

    <!-- ‚ïê‚ïê‚ïê LIVE POSTS ‚ïê‚ïê‚ïê -->
    <div class="admin-section">
      <div class="admin-section-header">
        <span class="admin-section-title">Live Board</span>
        <span class="admin-section-subtitle"><%= live.length %> posts</span>
      </div>

      <% if (live.length === 0) { %>
        <div style="text-align: center; padding: 2rem 1rem; color: var(--text-muted); font-size: 0.85rem;">No live posts.</div>
      <% } else { %>
        <% live.forEach((post, idx) => { %>
          <div class="post-row">
            <div class="post-row-header">
              <span class="post-row-title"><%= post.title %></span>
              <span class="badge badge-section-<%= post.section %>"><%= post.section.replace('_', ' ') %></span>
              <% if (post.pinned) { %><span class="badge badge-pinned-admin">Pinned</span><% } %>
              <% if (post.urgent) { %><span class="badge badge-urgent-admin">Urgent</span><% } %>
              <% if (post.editedAt) { %><span class="badge badge-edited">edited</span><% } %>
              <% if (post.modPost) { %><span class="badge badge-mod">mod post</span><% } %>
              <% if (post.submitter) { %>
                <span class="badge-submitter" title="Anonymous submitter #<%= post.submitter.id %>">User #<%= post.submitter.id %><% if (submitterCounts[post.submitterId] > 1) { %> <span class="submitter-count">(<%= submitterCounts[post.submitterId] %> posts)</span><% } %></span>
              <% } %>
            </div>
            <div class="post-row-desc rich-content"><%- post.desc %></div>
            <div class="post-row-meta">
              <% if (post.location) { %><span>üìç <%= post.location %></span><span class="sep"></span><% } %>
              <span>Approved <%= post.approvedAt ? new Date(post.approvedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'n/a' %></span>
              <% if (post.expiresAt) { %><span class="sep"></span><span>Expires <%= new Date(post.expiresAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %></span><% } %>
            </div>
            <% if (post.modNote) { %>
              <div class="mod-note-inline"><strong>Mod note:</strong> <%= post.modNote %></div>
            <% } %>

            <!-- Live Post Actions -->
            <div class="actions-row">
              <!-- State toggles -->
              <div class="action-group">
                <form method="POST" action="/admin/pin/<%= post.id %>" style="display:inline;">
                  <button type="submit" class="action-btn outline pin <%= post.pinned ? 'active' : '' %>">
                    <%= post.pinned ? 'Unpin' : 'Pin' %>
                  </button>
                </form>
                <form method="POST" action="/admin/urgent/<%= post.id %>" style="display:inline;">
                  <button type="submit" class="action-btn outline urgent-action <%= post.urgent ? 'active' : '' %>">
                    <%= post.urgent ? 'Not Urgent' : 'Urgent' %>
                  </button>
                </form>
              </div>

              <span class="actions-sep"></span>

              <!-- Edit + Notes -->
              <div class="action-group">
                <button type="button" class="action-btn outline" data-bs-toggle="collapse" data-bs-target="#liveEdit-<%= idx %>">Edit</button>
                <button type="button" class="action-btn outline" data-bs-toggle="collapse" data-bs-target="#modNote-<%= idx %>">Mod Note</button>
                <% if (hasApiKey) { %>
                  <form method="POST" action="/admin/rewrite/<%= post.id %>" style="display:inline;">
                    <input type="hidden" name="action" value="quick">
                    <button type="submit" class="action-btn outline ai">Rewrite</button>
                  </form>
                <% } %>
                <% if (post.descHistory && post.descHistory.length > 0) { %>
                  <form method="POST" action="/admin/undo/<%= post.id %>" style="display:inline;">
                    <button type="submit" class="action-btn outline undo">Undo (<%= post.descHistory.length %>)</button>
                  </form>
                <% } %>
              </div>

              <span class="actions-sep"></span>

              <!-- Destructive -->
              <div class="action-group">
                <form method="POST" action="/admin/expire/<%= post.id %>" style="display:inline;" onsubmit="return confirm('Expire this post?')">
                  <button type="submit" class="action-btn outline">Expire</button>
                </form>
                <form method="POST" action="/admin/delete/<%= post.id %>" style="display:inline;" onsubmit="return confirm('Remove this post? It will move to archive.')">
                  <button type="submit" class="action-btn outline delete">Delete</button>
                </form>
              </div>
            </div>

            <!-- Live Edit Form (collapsed) -->
            <div class="collapse mt-2" id="liveEdit-<%= idx %>">
              <form method="POST" action="/admin/edit/<%= post.id %>" class="inline-panel">
                <div style="margin-bottom: 8px;">
                  <input type="text" name="title" class="vvc-input" value="<%= post.title %>" maxlength="100" style="font-size: 0.85rem; padding: 8px 12px;">
                </div>
                <div style="margin-bottom: 8px;">
                  <div class="editor-wrapper">
                    <div class="editor-toolbar" id="editToolbar-l<%= idx %>">
                      <button type="button" data-action="bold"><b>B</b></button>
                      <button type="button" data-action="italic"><i>I</i></button>
                      <div class="sep"></div>
                      <button type="button" data-action="heading2">H2</button>
                      <button type="button" data-action="heading3">H3</button>
                      <div class="sep"></div>
                      <button type="button" data-action="bulletList">‚Ä¢ List</button>
                      <button type="button" data-action="link">Link</button>
                      <div class="sep"></div>
                      <button type="button" data-action="image">Image</button>
                      <button type="button" data-action="video">Video</button>
                    </div>
                    <div class="admin-editor tiptap-content admin-editor" id="editEditor-l<%= idx %>" data-content="<%= encodeURIComponent(post.desc) %>"></div>
                  </div>
                  <input type="hidden" name="desc" id="editHidden-l<%= idx %>">
                </div>
                <div style="margin-bottom: 8px;">
                  <input type="text" name="location" class="vvc-input" value="<%= post.location || '' %>" maxlength="100" placeholder="Location (optional)" style="font-size: 0.85rem; padding: 8px 12px;">
                </div>
                <div style="margin-bottom: 8px;">
                  <label style="font-size: 0.8rem; color: var(--text-secondary); display: block; margin-bottom: 6px;">Map Pin (optional)</label>
                  <div id="adminMap-l<%= idx %>" class="admin-map-container"></div>
                  <div class="map-coord-display">
                    <span id="coordDisplay-l<%= idx %>">
                      <% if (post.latitude && post.longitude) { %>
                        üìç <%= post.latitude.toFixed(5) %>, <%= post.longitude.toFixed(5) %>
                      <% } else { %>
                        Click map to drop a pin
                      <% } %>
                    </span>
                    <button type="button" class="btn-link-vvc" id="removeMapPin-l<%= idx %>" style="font-size: 0.75rem; margin-left: 8px;">
                      Remove pin
                    </button>
                  </div>
                  <input type="hidden" name="latitude" id="adminLat-l<%= idx %>" value="<%= post.latitude || '' %>">
                  <input type="hidden" name="longitude" id="adminLng-l<%= idx %>" value="<%= post.longitude || '' %>">
                  <input type="hidden" name="locationName" id="adminName-l<%= idx %>" value="<%= post.locationName || '' %>">
                </div>
                <div style="margin-bottom: 8px;">
                  <select name="section" class="vvc-select" style="font-size: 0.85rem; padding: 8px 12px;">
                    <% ['ALERT', 'HAPPENINGS', 'LOST_FOUND', 'NEIGHBORS', 'BOARD_NOTES'].forEach(s => { %>
                      <option value="<%= s %>" <%= post.section === s ? 'selected' : '' %>><%= s.replace('_', ' ') %></option>
                    <% }) %>
                  </select>
                </div>
                <div class="panel-actions">
                  <button type="submit" class="panel-btn-primary">Save Edit</button>
                  <button type="button" class="panel-btn-ghost" data-bs-toggle="collapse" data-bs-target="#liveEdit-<%= idx %>">Discard</button>
                </div>
              </form>
            </div>

            <!-- Mod Note Form (collapsed) -->
            <div class="collapse mt-2" id="modNote-<%= idx %>">
              <form method="POST" action="/admin/modnote/<%= post.id %>" class="inline-panel">
                <textarea name="modNote" class="vvc-textarea" rows="2" maxlength="1000" placeholder="Internal mod note (not visible to public)" style="font-size: 0.82rem; min-height: 60px;"><%= post.modNote || '' %></textarea>
                <div class="panel-actions">
                  <button type="submit" class="panel-btn-primary">Save Note</button>
                </div>
              </form>
            </div>
          </div>
        <% }) %>
      <% } %>
    </div>

    <!-- ‚ïê‚ïê‚ïê ARCHIVE ‚ïê‚ïê‚ïê -->
    <div class="admin-section">
      <div class="admin-section-header" style="cursor: pointer; border-bottom-color: var(--text-muted);" data-bs-toggle="collapse" data-bs-target="#archiveSection">
        <span class="admin-section-title">Archive</span>
        <span class="admin-section-count" style="background: var(--text-muted);"><%= archived.length %></span>
        <span style="font-size: 0.7rem; color: var(--text-muted); margin-left: 4px;">‚ñ∏ click to expand</span>
      </div>
      <div class="collapse" id="archiveSection">
        <% if (archived.length === 0) { %>
          <p style="font-size: 0.82rem; color: var(--text-muted);">Archive is empty.</p>
        <% } else { %>
          <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 10px;">All rejected, deleted, and expired posts live here. Restore moves back to pending.</p>
          <% archived.forEach((post, idx) => { %>
            <div class="post-row" style="opacity: 0.8;">
              <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px; flex-wrap: wrap;">
                <div style="display: flex; align-items: center; gap: 6px; flex-wrap: wrap; flex: 1;">
                  <span class="post-row-title" style="font-size: 0.85rem;"><%= post.title %></span>
                  <span class="badge badge-section-<%= post.section %>"><%= post.section.replace('_', ' ') %></span>
                  <span class="badge" style="background: var(--accent-<%= post.status === 'REJECTED' ? 'danger' : 'warning' %>-soft); color: var(--accent-<%= post.status === 'REJECTED' ? 'danger' : 'warning' %>);"><%= post.status %></span>
                  <% if (post.submitter) { %>
                    <span class="badge-submitter" title="Anonymous submitter #<%= post.submitter.id %>">User #<%= post.submitter.id %><% if (submitterCounts[post.submitterId] > 1) { %> <span class="submitter-count">(<%= submitterCounts[post.submitterId] %> posts)</span><% } %></span>
                  <% } %>
                </div>
                <div style="display: flex; gap: 6px;">
                  <form method="POST" action="/admin/restore/<%= post.id %>" style="display:inline;">
                    <button class="action-btn outline success">Restore</button>
                  </form>
                  <form method="POST" action="/admin/purge/<%= post.id %>" style="display:inline;"
                        onsubmit="return confirm('Permanently delete this post? This cannot be undone.')">
                    <button class="action-btn outline delete">Purge</button>
                  </form>
                </div>
              </div>
              <div class="post-row-desc rich-content" style="margin-top: 4px;"><%- post.desc %></div>
              <div class="post-row-meta" style="margin-top: 4px;">
                <% if (post.location) { %><span>üìç <%= post.location %></span><span class="sep"></span><% } %>
                <span>Submitted <%= new Date(post.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' }) %></span>
                <% if (post.modNote) { %><span class="sep"></span><span><em>Note: <%= post.modNote %></em></span><% } %>
              </div>
            </div>
          <% }) %>
        <% } %>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê BOARD NOTES COMPOSER ‚ïê‚ïê‚ïê -->
    <div class="admin-section">
      <div class="admin-section-header">
        <span class="admin-section-title">Compose Board Note</span>
      </div>
      <div class="composer-card">
        <p class="composer-hint">Board Notes go live immediately ‚Äî no review needed. Visible on the public board.</p>
        <form method="POST" action="/admin/notes" id="notesForm">
          <div style="margin-bottom: 10px;">
            <input type="text" name="title" class="vvc-input" placeholder="Note title" maxlength="100" required style="font-size: 0.85rem; padding: 8px 12px;">
          </div>
          <div style="margin-bottom: 10px;">
            <div class="editor-wrapper">
              <div class="editor-toolbar" id="notesToolbar">
                <button type="button" data-action="bold"><b>B</b></button>
                <button type="button" data-action="italic"><i>I</i></button>
                <div class="sep"></div>
                <button type="button" data-action="heading2">H2</button>
                <button type="button" data-action="heading3">H3</button>
                <div class="sep"></div>
                <button type="button" data-action="bulletList">‚Ä¢ List</button>
                <button type="button" data-action="orderedList">1. List</button>
                <button type="button" data-action="blockquote">Quote</button>
                <div class="sep"></div>
                <button type="button" data-action="link">Link</button>
                <button type="button" data-action="image">Image</button>
                <button type="button" data-action="video">Video</button>
              </div>
              <div id="notesEditor" class="tiptap-content admin-editor"></div>
            </div>
            <input type="hidden" name="desc" id="notesHidden">
          </div>
          <button type="submit" class="panel-btn-primary">Publish Board Note</button>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/theme.js"></script>
  <script type="module" src="/js/admin-init.js"></script>
  <script type="module" src="/js/admin-maps.js"></script>
</body>
</html>
